
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>adc2019 &#8212; adc2019 20190802 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '20190802',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">adc2019 20190802 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for adc2019</h1><div class="highlight"><pre>
<span></span><span class="ch">#! /usr/bin/env python3</span>
<span class="c1">#coding: utf-8</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">DA Symbosium 2019 Algorithm Design Contest</span>
<span class="sd">==========================================</span>


<span class="sd">Variables</span>
<span class="sd">----------</span>

<span class="sd">block : dict</span>
<span class="sd">    - key is tuple (type, index)</span>
<span class="sd">        - type is string, {&#39;a&#39;, &#39;b&#39;, ... &#39;g&#39;}, see below :ref:`block type name &lt;image-block-type&gt;` image.</span>
<span class="sd">        - index is int, {0, 1, 2, 3} means rotation 0, 90, 180, 270.</span>
<span class="sd">    - value is list of string, block data.</span>

<span class="sd">np_block : dict</span>
<span class="sd">    same as block, but value is numpy array</span>

<span class="sd">block_color : dict</span>
<span class="sd">    - key is string, {&#39;a&#39;, &#39;b&#39;, ... &#39;g&#39;}</span>
<span class="sd">    - value is string, RGB color &#39;#0123ab&#39;</span>

<span class="sd">.. _image-block-type:</span>

<span class="sd">block type name</span>
<span class="sd">^^^^^^^^^^^^^^^</span>
<span class="sd">- tetromino is &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;.</span>
<span class="sd">- monomino is &#39;z&#39;.</span>

<span class="sd">.. image:: ../_static/block_type.png</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># &#39;__blocks_in&#39; is source data. block is made from __blocks_in.</span>
<span class="n">__blocks_in</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">X</span>
<span class="sd">X</span>
<span class="sd">X</span>
<span class="sd">X</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">XXXX</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">XX</span>
<span class="sd">XX</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd"> X </span>
<span class="sd">XXX</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">X </span>
<span class="sd">XX</span>
<span class="sd">X </span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">XXX</span>
<span class="sd"> X </span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd"> X</span>
<span class="sd">XX</span>
<span class="sd"> X</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">X </span>
<span class="sd">X </span>
<span class="sd">XX</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">XXX</span>
<span class="sd">X  </span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">XX</span>
<span class="sd"> X</span>
<span class="sd"> X</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  X</span>
<span class="sd">XXX</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd"> X</span>
<span class="sd"> X</span>
<span class="sd">XX</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">X  </span>
<span class="sd">XXX</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">XX</span>
<span class="sd">X </span>
<span class="sd">X </span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">XXX</span>
<span class="sd">  X</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd"> XX</span>
<span class="sd">XX </span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">X </span>
<span class="sd">XX</span>
<span class="sd"> X</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">XX </span>
<span class="sd"> XX</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd"> X</span>
<span class="sd">XX</span>
<span class="sd">X </span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="s1">&#39;X&#39;</span>
<span class="p">}</span>

<span class="n">__same</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">))),</span>
          <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">))),</span>
          <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">))),</span>
          <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">))),</span>
          <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">))))</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">__same is used for copying block data</span>
<span class="sd">(type, ((dst_index, src_index), ...)) will make</span>
<span class="sd">blocks[(type, dst_index)] = blocks[(type, src_index)]</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">block_color</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffff00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;#c6e3b5&#39;</span><span class="p">,</span>
               <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffe79c&#39;</span><span class="p">,</span>
               <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="s1">&#39;#bdd7ef&#39;</span><span class="p">,</span>
               <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="s1">&#39;#ffc300&#39;</span><span class="p">,</span>
               <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="s1">&#39;#5a9ad6&#39;</span><span class="p">,</span>
               <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="s1">&#39;#f7cbad&#39;</span><span class="p">,</span>
               <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="s1">&#39;#a0a0a0&#39;</span><span class="p">}</span>
<span class="n">block</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">np_block</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">__setup</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    setup variables: block, np_block</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">__blocks_in</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">block</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">__same</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dst</span><span class="p">,</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">block</span><span class="p">[(</span><span class="n">t</span><span class="p">,</span> <span class="n">dst</span><span class="p">)]</span> <span class="o">=</span> <span class="n">block</span><span class="p">[(</span><span class="n">t</span><span class="p">,</span> <span class="n">src</span><span class="p">)]</span>

    <span class="n">tbl</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">({</span><span class="s1">&#39; &#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">})</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tbl</span><span class="p">)])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">np_block</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Error: cannot convert&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span>

<span class="n">__setup</span><span class="p">()</span>

<div class="viewcode-block" id="prt"><a class="viewcode-back" href="../apis/adc2019.html#adc2019.prt">[docs]</a><span class="k">def</span> <span class="nf">prt</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    debug print block data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key : tuple (type, index)</span>
<span class="sd">        | type = {&#39;a&#39;, &#39;b&#39;, ... &#39;g&#39;}</span>
<span class="sd">        | index = {0, 1, 2, 3}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">block</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_Q_file"><a class="viewcode-back" href="../apis/adc2019.html#adc2019.read_Q_file">[docs]</a><span class="k">def</span> <span class="nf">read_Q_file</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read Q file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file : str</span>
<span class="sd">        filename</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    read_Q : tuple</span>
<span class="sd">        see :py:meth:`adc2019.read_Q`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="c1"># universal newlines mode</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">read_Q</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="read_Q"><a class="viewcode-back" href="../apis/adc2019.html#adc2019.read_Q">[docs]</a><span class="k">def</span> <span class="nf">read_Q</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read Q data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : str</span>
<span class="sd">        | Q data is like</span>
<span class="sd">        | SIZE 10X10</span>
<span class="sd">        | BLOCK_NUM 8</span>
<span class="sd">        | BLOCK#1 1X4</span>
<span class="sd">        | ...</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    size : tuple</span>
<span class="sd">        (x,y) of line &quot;SIZE xXy&quot;</span>

<span class="sd">    block_num : int</span>
<span class="sd">        b of line &quot;BLOCK_NUM b&quot;</span>

<span class="sd">    block_size : list</span>
<span class="sd">        list of defined block size.</span>

<span class="sd">    block_data : list of numpy array, dtype=int</span>
<span class="sd">        list of defined block data.</span>

<span class="sd">    block_type : list of tuple</span>
<span class="sd">        (type, index)</span>

<span class="sd">    n_lines : int</span>
<span class="sd">        number of lines</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    return value of block_size is list of tuple, like</span>
<span class="sd">    [(1,4), (3,2), (2,2), ...]</span>

<span class="sd">    return value of block_data is list of defined block data.</span>

<span class="sd">    ============ =====================</span>
<span class="sd">    value        contents</span>
<span class="sd">    ============ =====================</span>
<span class="sd">         -1      block cell without number</span>
<span class="sd">          0      not block cell</span>
<span class="sd">         others  block cell with number</span>
<span class="sd">    ============ =====================</span>

<span class="sd">    return value of block_type is tuple (type, index)</span>

<span class="sd">    ===== ======= ===================</span>
<span class="sd">    value type    example</span>
<span class="sd">    ===== ======= ===================</span>
<span class="sd">    type  string  {&#39;a&#39;, &#39;b&#39;, ... &#39;g&#39;}</span>
<span class="sd">    index int     {0, 1, 2, 3}</span>
<span class="sd">    ===== ======= ===================</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">debug</span>
    <span class="n">input_line_cnt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># (x,y)</span>
    <span class="n">in_block</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">block_num</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># n</span>
    <span class="n">block_size_x</span><span class="p">,</span> <span class="n">block_size_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">dict_block_size</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dict_block_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">block_tmp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">block_num_tmp</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#numbers = {} # key=number, value=bool. True if the number exists</span>
    <span class="n">num_lines</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># number of lines (== max number)</span>
    <span class="n">pSIZE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;SIZE\s+([0-9]+)X([0-9]+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="n">pBLOCK_NUM</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;BLOCK_NUM\s+([0-9]+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="n">pBLOCK</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;BLOCK#([0-9]+)\s+([0-9]+)X([0-9]+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="c1"># for make possible to detect end of data</span>

    <span class="k">def</span> <span class="nf">add_block</span><span class="p">():</span>
        <span class="k">nonlocal</span> <span class="n">in_block</span><span class="p">,</span> <span class="n">dict_block_size</span><span class="p">,</span> <span class="n">dict_block_data</span><span class="p">,</span> <span class="n">block_num_tmp</span><span class="p">,</span> <span class="n">block_tmp</span><span class="p">,</span> <span class="n">block_size_x</span><span class="p">,</span> <span class="n">block_size_y</span><span class="p">,</span> <span class="n">block_tmp</span>
        <span class="n">in_block</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#    block_size[1] = (x,y) of &quot;BLOCK#1 xXy&quot;</span>
        <span class="n">dict_block_size</span><span class="p">[</span><span class="n">block_num_tmp</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">block_size_x</span><span class="p">,</span> <span class="n">block_size_y</span><span class="p">)</span>
        <span class="c1">#    block_data[1] = body data of &quot;BLOCK#1 xXy&quot;</span>
        <span class="n">dict_block_data</span><span class="p">[</span><span class="n">block_num_tmp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">block_tmp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dict_block_data</span><span class="p">[</span><span class="n">block_num_tmp</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">block_size_y</span><span class="p">,</span> <span class="n">block_size_x</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-Q3: inconsistent block size&#39;</span><span class="p">,</span> <span class="n">block_num_tmp</span><span class="p">,</span> <span class="p">(</span><span class="n">block_size_x</span><span class="p">,</span> <span class="n">block_size_y</span><span class="p">),</span> <span class="n">dict_block_data</span><span class="p">[</span><span class="n">block_num_tmp</span><span class="p">])</span>
        <span class="n">block_num_tmp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">block_tmp</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">input_line_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">in_block</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">in_block</span><span class="p">:</span> <span class="c1"># end of BLOCK definition</span>
                <span class="n">add_block</span><span class="p">()</span>
            <span class="k">continue</span>            
        <span class="n">m</span> <span class="o">=</span> <span class="n">pSIZE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">72</span> <span class="ow">and</span>
                    <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">72</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-Q4: invalid size&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">pBLOCK_NUM</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">block_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">continue</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">pBLOCK</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">in_block</span><span class="p">:</span>
                <span class="n">add_block</span><span class="p">()</span>
            <span class="n">in_block</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">block_num_tmp</span><span class="p">,</span> <span class="n">block_size_x</span><span class="p">,</span> <span class="n">block_size_y</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()]</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">block_num_tmp</span> <span class="ow">and</span> <span class="n">block_num_tmp</span> <span class="o">&lt;=</span> <span class="n">block_num</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-Q5: invalid block number&#39;</span><span class="p">,</span> <span class="n">block_num_tmp</span><span class="p">,</span> <span class="n">block_num</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">in_block</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                <span class="c1"># c = &#39;+&#39; or string of number(&#39;0&#39;, &#39;1&#39;, .., &#39;99&#39; ...)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># block_without_number</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="c1"># 0=not_block, others=block_with_number</span>
                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                <span class="n">num_lines</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">num_lines</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
            <span class="n">block_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-Q7: unknown line&#39;</span><span class="p">,</span> <span class="n">input_line_cnt</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    
    <span class="c1"># convert dict to list</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">dict_block_size</span><span class="p">)</span> <span class="o">==</span> <span class="n">block_num</span><span class="p">)</span> <span class="ow">and</span>
            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dict_block_data</span><span class="p">)</span> <span class="o">==</span> <span class="n">block_num</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-Q6: inconsistent block definition&#39;</span><span class="p">,</span> <span class="n">block_num</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict_block_size</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict_block_data</span><span class="p">))</span>
    <span class="n">block_size</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">block_num</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">block_data</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">block_num</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">block_type</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">block_num</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">block_num</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_block_size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">block_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_block_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-Q8: BLOCK# not found&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="c1"># check1. numbers: each number should appear twice.</span>
    <span class="c1"># check2. block shape: it must be tetromino or monomino</span>
    <span class="n">num_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_lines</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">blk</span> <span class="ow">in</span>  <span class="nb">enumerate</span><span class="p">(</span><span class="n">block_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span> <span class="c1"># [0] is dummy, None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">blk</span><span class="o">.</span><span class="n">ravel</span><span class="p">():</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">num_count</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">blk_type</span> <span class="o">=</span> <span class="n">match_block_shape</span><span class="p">(</span><span class="n">blk</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">blk_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-Q2: unknown block shape&#39;</span><span class="p">,</span> <span class="n">blk</span><span class="p">)</span>
        <span class="n">block_type</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">blk_type</span> <span class="c1"># j = 0,1,2...</span>
    <span class="c1">#print(&#39;num_count&#39;, num_count)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">num_count</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-Q1: all numbers must appear twice&#39;</span><span class="p">,</span> <span class="n">num_count</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">size</span><span class="p">,</span> <span class="n">block_num</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">block_data</span><span class="p">,</span> <span class="n">block_type</span><span class="p">,</span> <span class="n">num_lines</span></div>


<div class="viewcode-block" id="read_A_file"><a class="viewcode-back" href="../apis/adc2019.html#adc2019.read_A_file">[docs]</a><span class="k">def</span> <span class="nf">read_A_file</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read A file</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file : str</span>
<span class="sd">        filename</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    read_A : tuple</span>
<span class="sd">         see :py:meth:`adc2019.read_A`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="c1"># universal newlines mode</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">read_A</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_A"><a class="viewcode-back" href="../apis/adc2019.html#adc2019.read_A">[docs]</a><span class="k">def</span> <span class="nf">read_A</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read A data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : str</span>
<span class="sd">        | A data is like</span>
<span class="sd">        | SIZE 9X8</span>
<span class="sd">        | 0, 1, 1, 1, 1, 2, 2, 2, 2</span>
<span class="sd">        | 0, 0, ...</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    size : tuple</span>
<span class="sd">        For example (9,8) in case of &#39;SIZE 9X8&#39;</span>

<span class="sd">    ban_data : numpy array</span>
<span class="sd">        board data</span>

<span class="sd">    block_pos : dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">debug</span>
    <span class="n">input_line_cnt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># (x,y)</span>
    <span class="n">in_size</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">ban_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dict_block_pos</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">pSIZE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;SIZE\s+([0-9]+)X([0-9]+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="n">pBLOCK</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;BLOCK\s*#\s*([0-9]+)\s+@\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*\)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">input_line_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">in_size</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">in_size</span><span class="p">:</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">ban_data</span><span class="p">):</span>
                    <span class="n">in_size</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">continue</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">pSIZE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">in_size</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-A1: syntax error in SIZE&#39;</span><span class="p">)</span>
            <span class="n">in_size</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">72</span> <span class="ow">and</span>
                    <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">72</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-A2: invalid size&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">pBLOCK</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">in_size</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()]</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">dict_block_pos</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-A3: duplicated BLOCK#&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-A4: SIZE not found&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span>
                    <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-A5: invalid block position&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="n">dict_block_pos</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">in_size</span><span class="p">:</span>
            <span class="c1"># Issues#17 https://github.com/dasadc/dasadc.github.io/issues/17</span>
            <span class="n">line2</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;-1&#39;</span><span class="p">)</span>
            <span class="n">ban_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">line2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)])</span>
            <span class="k">continue</span>

        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-A6: unknown line&#39;</span><span class="p">,</span> <span class="n">input_line_cnt</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

    <span class="n">block_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict_block_pos</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">in_size</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">block_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-A7: BLOCK not found&#39;</span><span class="p">)</span>
    <span class="n">block_pos</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">block_num</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">block_num</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">block_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_block_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-A8: BLOCK# not found&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">ban_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ban_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ban_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-A9: size mismatch&#39;</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">ban_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">size</span><span class="p">,</span> <span class="n">ban_data</span><span class="p">,</span> <span class="n">block_pos</span></div>


<div class="viewcode-block" id="match_block_shape"><a class="viewcode-back" href="../apis/adc2019.html#adc2019.match_block_shape">[docs]</a><span class="k">def</span> <span class="nf">match_block_shape</span><span class="p">(</span><span class="n">npb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    from numpy array block data, detect block shape type.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    npb : numpy array</span>
<span class="sd">        one of elements of block_data returned from read_Q()</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    k : tuple  (type, index)</span>
<span class="sd">        type is string, {&#39;a&#39;, &#39;b&#39;, ... &#39;g&#39;}</span>
<span class="sd">        index is int, {0, 1, 2, 3}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">mat</span> <span class="ow">in</span> <span class="n">np_block</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">mat</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">npb</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">mat</span><span class="o">*</span><span class="n">npb</span> <span class="o">==</span> <span class="n">npb</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">k</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="detect_terminal"><a class="viewcode-back" href="../apis/adc2019.html#adc2019.detect_terminal">[docs]</a><span class="k">def</span> <span class="nf">detect_terminal</span><span class="p">(</span><span class="n">n_lines_Q</span><span class="p">,</span> <span class="n">block_data_Q</span><span class="p">,</span> <span class="n">block_pos_A</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    detect start and end point of number-lines</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_lines_Q : int</span>
<span class="sd">        number of lines</span>

<span class="sd">    block_data_Q : list of numpy array</span>
<span class="sd">        block shape data</span>

<span class="sd">    block_pos_A  : list of tupple</span>
<span class="sd">        block position</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    terminal : list of dict</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; terminal</span>
<span class="sd">    [{&#39;block&#39;: 1, &#39;xy&#39;: (1, 0)}, {&#39;block&#39;: 4, &#39;xy&#39;: (4, 0)}],</span>
<span class="sd">    [{&#39;block&#39;: 4, &#39;xy&#39;: (5, 0)}, {&#39;block&#39;: 6, &#39;xy&#39;: (5, 4)}],</span>
<span class="sd">    [{&#39;block&#39;: 3, &#39;xy&#39;: (0, 6)}, {&#39;block&#39;: 5, &#39;xy&#39;: (6, 7)}],</span>
<span class="sd">    [{&#39;block&#39;: 4, &#39;xy&#39;: (4, 1)}, {&#39;block&#39;: 8, &#39;xy&#39;: (7, 4)}],</span>
<span class="sd">    [{&#39;block&#39;: 6, &#39;xy&#39;: (3, 5)}, {&#39;block&#39;: 7, &#39;xy&#39;: (2, 5)}],</span>
<span class="sd">    [{&#39;block&#39;: 2, &#39;xy&#39;: (3, 3)}, {&#39;block&#39;: 7, &#39;xy&#39;: (3, 4)}],</span>
<span class="sd">    [{&#39;block&#39;: 1, &#39;xy&#39;: (1, 3)}, {&#39;block&#39;: 2, &#39;xy&#39;: (2, 3)}],</span>
<span class="sd">    [{&#39;block&#39;: 1, &#39;xy&#39;: (1, 2)}, {&#39;block&#39;: 2, &#39;xy&#39;: (3, 2)}],</span>
<span class="sd">    [{&#39;block&#39;: 3, &#39;xy&#39;: (1, 6)}, {&#39;block&#39;: 7, &#39;xy&#39;: (1, 5)}],</span>
<span class="sd">    [{&#39;block&#39;: 3, &#39;xy&#39;: (0, 4)}, {&#39;block&#39;: 7, &#39;xy&#39;: (2, 4)}],</span>
<span class="sd">    [{&#39;block&#39;: 5, &#39;xy&#39;: (4, 6)}, {&#39;block&#39;: 6, &#39;xy&#39;: (4, 5)}]]</span>

<span class="sd">    index=0 is unused.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">terminal</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_lines_Q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">blk</span> <span class="ow">in</span>  <span class="nb">enumerate</span><span class="p">(</span><span class="n">block_data_Q</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span> <span class="c1"># [0] is dummy, None</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">block_pos_A</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">by</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">blk</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">bx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="n">n_lines_Q</span><span class="p">:</span>
                    <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;block&#39;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span>
                            <span class="s1">&#39;xy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">bx</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">by</span><span class="p">)}</span>
                    <span class="n">terminal</span><span class="p">[</span><span class="n">val</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">terminal</span></div>


<div class="viewcode-block" id="check_data"><a class="viewcode-back" href="../apis/adc2019.html#adc2019.check_data">[docs]</a><span class="k">def</span> <span class="nf">check_data</span><span class="p">(</span><span class="n">data_Q</span><span class="p">,</span> <span class="n">data_A</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check block position is correct in board data.</span>
<span class="sd">    Number in block definition must be equal to number in board data.</span>
<span class="sd">    Check Number Link puzzle rules.</span>
<span class="sd">    Calculate attribute values of DA Symposium Algotirim Design Contest.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data_Q : tuple</span>
<span class="sd">        return value of read_Q()</span>

<span class="sd">    data_A : tuple</span>
<span class="sd">        return value of read_A()</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    info : dict</span>
<span class="sd">        several information of check results</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; ban_data</span>
<span class="sd">    array([[ 0,  1,  1,  1,  1,  2,  2,  2,  2],</span>
<span class="sd">           [ 0,  0,  0,  0,  4,  0,  0,  0,  2],</span>
<span class="sd">           [ 0,  8,  8,  8,  4,  4,  4,  4,  2],</span>
<span class="sd">           [ 0,  7,  7,  6,  0,  0,  0,  4,  2],</span>
<span class="sd">           [10, 10, 10,  6,  0,  2,  0,  4,  2],</span>
<span class="sd">           [ 0,  9,  5,  5, 11,  2,  2,  2,  2],</span>
<span class="sd">           [ 3,  9,  0,  0, 11,  0,  0,  0,  0],</span>
<span class="sd">           [ 3,  3,  3,  3,  3,  3,  3,  0,  0]])</span>

<span class="sd">    &gt;&gt;&gt; block_size</span>
<span class="sd">    [None, (1, 4), (3, 2), (2, 3), (2, 2), (3, 2), (3, 2), (3, 2), (3, 2)]</span>

<span class="sd">    &gt;&gt;&gt; block_pos</span>
<span class="sd">    [None, (1, 0), (2, 2), (0, 4), (4, 0), (4, 6), (3, 4), (1, 4), (5, 3)]</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; x,y = block_pos[1]</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; bx,by = block_size[1]</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; x,y,bx,by</span>
<span class="sd">    (1, 0, 1, 4)</span>

<span class="sd">    &gt;&gt;&gt; ban_data[y:(y+by), x:(x+bx)]</span>
<span class="sd">    array([[1],</span>
<span class="sd">           [0],</span>
<span class="sd">           [8],</span>
<span class="sd">           [7]])</span>

<span class="sd">    &gt;&gt;&gt; block_data[1]</span>
<span class="sd">    array([[ 1],</span>
<span class="sd">           [-1],</span>
<span class="sd">           [ 8],</span>
<span class="sd">           [ 7]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">size_Q</span><span class="p">,</span> <span class="n">block_num_Q</span><span class="p">,</span> <span class="n">block_size_Q</span><span class="p">,</span> <span class="n">block_data_Q</span><span class="p">,</span> <span class="n">block_type_Q</span><span class="p">,</span> <span class="n">n_lines_Q</span> <span class="o">=</span> <span class="n">data_Q</span>
    <span class="n">size_A</span><span class="p">,</span> <span class="n">ban_data_A</span><span class="p">,</span> <span class="n">block_pos_A</span> <span class="o">=</span> <span class="n">data_A</span>

    <span class="n">block_num_A</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">block_pos_A</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># dummy data, block_pos_A[0]=None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">block_num_A</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">block_size_Q</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span>
            <span class="n">block_num_A</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">block_data_Q</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-QA1: number of block mismatch&#39;</span><span class="p">)</span>

    <span class="c1"># check-QA2: numbers on blocks in the board must be same as defined blocks.</span>
    <span class="c1"># check-QA3: block must not be overlapped.</span>
    <span class="n">ban_check3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ban_data_A</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">block_num_A</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">block_type_Q</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">block_pos_A</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">block_size_Q</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
        <span class="c1">#print(&#39;block %d: xy(%d, %d) wh(%d, %d)&#39; % (b, x, y, w, h))</span>
        <span class="n">block_ban</span> <span class="o">=</span> <span class="n">ban_data_A</span><span class="p">[</span><span class="n">y</span><span class="p">:(</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),</span> <span class="n">x</span><span class="p">:(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">)]</span>
        <span class="n">block_ban_masked</span> <span class="o">=</span> <span class="n">block_ban</span> <span class="o">*</span> <span class="n">np_block</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">ban_check3</span><span class="p">[</span><span class="n">y</span><span class="p">:(</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),</span><span class="n">x</span><span class="p">:(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">np_block</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="c1"># put block on ban_check3</span>
        <span class="c1"># Issues#17 https://github.com/dasadc/dasadc.github.io/issues/17</span>
        <span class="c1"># Replace -1 by 0</span>
        <span class="n">tmp_block_Q</span> <span class="o">=</span> <span class="n">block_data_Q</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">tmp_block_ban_masked</span> <span class="o">=</span> <span class="n">block_ban_masked</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">tmp_block_Q</span><span class="p">[</span><span class="n">tmp_block_Q</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">tmp_block_ban_masked</span><span class="p">[</span><span class="n">tmp_block_ban_masked</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#print(tmp_block_Q)</span>
        <span class="c1">#print(tmp_block_ban_masked)</span>
        <span class="c1">#print(tmp_block_Q == tmp_block_ban_masked)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tmp_block_Q</span> <span class="o">==</span> <span class="n">tmp_block_ban_masked</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-QA2: inconsistent numbers on block&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">block_data_Q</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="n">block_ban_masked</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ban_check3</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-QA3: block overlapped&#39;</span><span class="p">,</span> <span class="n">ban_check3</span><span class="p">)</span>

    <span class="n">terminal</span> <span class="o">=</span> <span class="n">detect_terminal</span><span class="p">(</span><span class="n">n_lines_Q</span><span class="p">,</span> <span class="n">block_data_Q</span><span class="p">,</span> <span class="n">block_pos_A</span><span class="p">)</span>
    <span class="n">ban_count</span><span class="p">,</span> <span class="n">ban_corner</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">count_neighbors</span><span class="p">(</span><span class="n">ban_data_A</span><span class="p">)</span>
    <span class="n">line_length</span><span class="p">,</span> <span class="n">line_corner</span> <span class="o">=</span> <span class="n">check_lines</span><span class="p">(</span><span class="n">ban_data_A</span><span class="p">,</span> <span class="n">terminal</span><span class="p">,</span> <span class="n">ban_count</span><span class="p">,</span> <span class="n">ban_corner</span><span class="p">,</span> <span class="n">n_lines_Q</span><span class="p">)</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">bounding_box</span><span class="p">(</span><span class="n">ban_data_A</span><span class="p">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;terminal&#39;</span><span class="p">:</span> <span class="n">terminal</span><span class="p">,</span>
            <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">ban_count</span><span class="p">,</span>
            <span class="s1">&#39;corner&#39;</span><span class="p">:</span> <span class="n">ban_corner</span><span class="p">,</span>
            <span class="s1">&#39;line_length&#39;</span><span class="p">:</span> <span class="n">line_length</span><span class="p">,</span>
            <span class="s1">&#39;line_corner&#39;</span><span class="p">:</span> <span class="n">line_corner</span><span class="p">,</span>
            <span class="s1">&#39;area&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y1</span><span class="o">-</span><span class="n">y0</span><span class="p">)}</span>
    <span class="k">return</span> <span class="n">info</span></div>


<div class="viewcode-block" id="count_neighbors"><a class="viewcode-back" href="../apis/adc2019.html#adc2019.count_neighbors">[docs]</a><span class="k">def</span> <span class="nf">count_neighbors</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;count</span>

<span class="sd">    count number of cells in neighbors</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    | □…target  Ｘ…neighbor</span>
<span class="sd">    | </span>
<span class="sd">    |    Ｘ           N</span>
<span class="sd">    |  Ｘ□Ｘ        W□E</span>
<span class="sd">    |    Ｘ           S</span>
<span class="sd">    |                     4C2 = 6</span>
<span class="sd">    | (線の折れ曲がり) = (接続数=2) &amp;&amp; (直線で突き抜けている場合を除く)</span>
<span class="sd">    | ■      ■      ■□      □■</span>
<span class="sd">    | □■    ■□      ■      ■</span>
<span class="sd">    | </span>
<span class="sd">    | (直線で突き抜けている場合) = north_eq &amp;&amp; south_eq || west_eq &amp;&amp; north_eq</span>
<span class="sd">    | ■      ■□■</span>
<span class="sd">    | □</span>
<span class="sd">    | ■</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : numpy array</span>
<span class="sd">        board data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    count    : numpy array</span>
<span class="sd">       number of cells located in neighbor(E,N,W,S) with same number</span>
<span class="sd">    corner   : numpy array</span>
<span class="sd">       1 = corner of line</span>
<span class="sd">    east_eq  : numpy array</span>
<span class="sd">       0 = cell has same number with east cell. 1 = not</span>
<span class="sd">    north_eq : numpy array</span>
<span class="sd">       0 = cell has same number with north cell. 1 = not</span>
<span class="sd">    west_eq  : numpy array</span>
<span class="sd">       0 = cell has same number with west cell. 1 = not</span>
<span class="sd">    south_eq : numpy array</span>
<span class="sd">       0 = cell has same number with south cell. 1 = not</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; a</span>
<span class="sd">    array([[ 0,  1,  1,  1,  1,  2,  2,  2,  2],</span>
<span class="sd">           [ 0,  0,  0,  0,  4,  0,  0,  0,  2],</span>
<span class="sd">           [ 0,  8,  8,  8,  4,  4,  4,  4,  2],</span>
<span class="sd">           [ 0,  7,  7,  6,  0,  0,  0,  4,  2],</span>
<span class="sd">           [10, 10, 10,  6,  0,  2,  0,  4,  2],</span>
<span class="sd">           [ 0,  9,  5,  5, 11,  2,  2,  2,  2],</span>
<span class="sd">           [ 3,  9,  0,  0, 11,  0,  0,  0,  0],</span>
<span class="sd">           [ 3,  3,  3,  3,  3,  3,  3,  0,  0]])</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; count</span>
<span class="sd">    array([[0, 1, 2, 2, 1, 1, 2, 2, 2],</span>
<span class="sd">           [0, 0, 0, 0, 1, 0, 0, 0, 2],</span>
<span class="sd">           [0, 1, 2, 1, 2, 2, 2, 2, 2],</span>
<span class="sd">           [0, 1, 1, 1, 0, 0, 0, 2, 2],</span>
<span class="sd">           [1, 2, 1, 1, 0, 1, 0, 1, 2],</span>
<span class="sd">           [0, 1, 1, 1, 1, 2, 2, 2, 2],</span>
<span class="sd">           [1, 1, 0, 0, 1, 0, 0, 0, 0],</span>
<span class="sd">           [2, 2, 2, 2, 2, 2, 1, 0, 0]])</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; corner</span>
<span class="sd">    array([[0, 0, 0, 0, 0, 0, 0, 0, 1],</span>
<span class="sd">           [0, 0, 0, 0, 0, 0, 0, 0, 0],</span>
<span class="sd">           [0, 0, 0, 0, 1, 0, 0, 1, 0],</span>
<span class="sd">           [0, 0, 0, 0, 0, 0, 0, 0, 0],</span>
<span class="sd">           [0, 0, 0, 0, 0, 0, 0, 0, 0],</span>
<span class="sd">           [0, 0, 0, 0, 0, 1, 0, 0, 1],</span>
<span class="sd">           [0, 0, 0, 0, 0, 0, 0, 0, 0],</span>
<span class="sd">           [1, 0, 0, 0, 0, 0, 0, 0, 0]])</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; east_eq</span>
<span class="sd">    array([[0, 1, 1, 1, 0, 1, 1, 1, 0],</span>
<span class="sd">           [0, 0, 0, 0, 0, 0, 0, 0, 0],</span>
<span class="sd">           [0, 1, 1, 0, 1, 1, 1, 0, 0],</span>
<span class="sd">           [0, 1, 0, 0, 0, 0, 0, 0, 0],</span>
<span class="sd">           [1, 1, 0, 0, 0, 0, 0, 0, 0],</span>
<span class="sd">           [0, 0, 1, 0, 0, 1, 1, 1, 0],</span>
<span class="sd">           [0, 0, 0, 0, 0, 0, 0, 0, 0],</span>
<span class="sd">           [1, 1, 1, 1, 1, 1, 0, 0, 0]])</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; north_eq</span>
<span class="sd">    array([[0, 0, 0, 0, 0, 0, 0, 0, 0],</span>
<span class="sd">           [0, 0, 0, 0, 0, 0, 0, 0, 1],</span>
<span class="sd">           [0, 0, 0, 0, 1, 0, 0, 0, 1],</span>
<span class="sd">           [0, 0, 0, 0, 0, 0, 0, 1, 1],</span>
<span class="sd">           [0, 0, 0, 1, 0, 0, 0, 1, 1],</span>
<span class="sd">           [0, 0, 0, 0, 0, 1, 0, 0, 1],</span>
<span class="sd">           [0, 1, 0, 0, 1, 0, 0, 0, 0],</span>
<span class="sd">           [1, 0, 0, 0, 0, 0, 0, 0, 0]])</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; west_eq</span>
<span class="sd">    array([[0, 0, 1, 1, 1, 0, 1, 1, 1],</span>
<span class="sd">           [0, 0, 0, 0, 0, 0, 0, 0, 0],</span>
<span class="sd">           [0, 0, 1, 1, 0, 1, 1, 1, 0],</span>
<span class="sd">           [0, 0, 1, 0, 0, 0, 0, 0, 0],</span>
<span class="sd">           [0, 1, 1, 0, 0, 0, 0, 0, 0],</span>
<span class="sd">           [0, 0, 0, 1, 0, 0, 1, 1, 1],</span>
<span class="sd">           [0, 0, 0, 0, 0, 0, 0, 0, 0],</span>
<span class="sd">           [0, 1, 1, 1, 1, 1, 1, 0, 0]])</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; south_eq</span>
<span class="sd">    array([[0, 0, 0, 0, 0, 0, 0, 0, 1],</span>
<span class="sd">           [0, 0, 0, 0, 1, 0, 0, 0, 1],</span>
<span class="sd">           [0, 0, 0, 0, 0, 0, 0, 1, 1],</span>
<span class="sd">           [0, 0, 0, 1, 0, 0, 0, 1, 1],</span>
<span class="sd">           [0, 0, 0, 0, 0, 1, 0, 0, 1],</span>
<span class="sd">           [0, 1, 0, 0, 1, 0, 0, 0, 0],</span>
<span class="sd">           [1, 0, 0, 0, 0, 0, 0, 0, 0],</span>
<span class="sd">           [0, 0, 0, 0, 0, 0, 0, 0, 0]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">a_east</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">a_north</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">a_west</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">a_south</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">count</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">a_east</span><span class="p">[</span> <span class="mi">0</span><span class="p">:</span><span class="n">h</span><span class="p">,</span>     <span class="mi">0</span><span class="p">:(</span><span class="n">w</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">h</span><span class="p">,</span>     <span class="mi">1</span><span class="p">:</span><span class="n">w</span><span class="p">]</span>     <span class="c1"># shift west  by 1</span>
    <span class="n">a_north</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">h</span><span class="p">,</span>     <span class="mi">0</span><span class="p">:</span><span class="n">w</span><span class="p">]</span>     <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:(</span><span class="n">h</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">:</span><span class="n">w</span><span class="p">]</span>     <span class="c1"># shift south by 1</span>
    <span class="n">a_west</span><span class="p">[</span> <span class="mi">0</span><span class="p">:</span><span class="n">h</span><span class="p">,</span>     <span class="mi">1</span><span class="p">:</span><span class="n">w</span><span class="p">]</span>     <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">h</span><span class="p">,</span>     <span class="mi">0</span><span class="p">:(</span><span class="n">w</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="c1"># shift east  by 1</span>
    <span class="n">a_south</span><span class="p">[</span><span class="mi">0</span><span class="p">:(</span><span class="n">h</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">:</span><span class="n">w</span><span class="p">]</span>     <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">h</span><span class="p">,</span>     <span class="mi">0</span><span class="p">:</span><span class="n">w</span><span class="p">]</span>     <span class="c1"># shift north by 1</span>
    <span class="n">east_eq</span>  <span class="o">=</span> <span class="p">((</span><span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a_east</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">north_eq</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a_north</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">west_eq</span>  <span class="o">=</span> <span class="p">((</span><span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a_west</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">south_eq</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a_south</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">east_eq</span> <span class="o">+</span> <span class="n">north_eq</span> <span class="o">+</span> <span class="n">west_eq</span> <span class="o">+</span> <span class="n">south_eq</span>
    <span class="n">corner</span> <span class="o">=</span> <span class="p">((</span><span class="n">count</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(((</span><span class="n">west_eq</span><span class="o">+</span><span class="n">east_eq</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">north_eq</span><span class="o">+</span><span class="n">south_eq</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># 論理最適化して、式を簡単にできるかも?</span>

    <span class="k">return</span> <span class="n">count</span><span class="p">,</span> <span class="n">corner</span><span class="p">,</span> <span class="n">east_eq</span><span class="p">,</span> <span class="n">north_eq</span><span class="p">,</span> <span class="n">west_eq</span><span class="p">,</span> <span class="n">south_eq</span></div>


<div class="viewcode-block" id="check_lines"><a class="viewcode-back" href="../apis/adc2019.html#adc2019.check_lines">[docs]</a><span class="k">def</span> <span class="nf">check_lines</span><span class="p">(</span><span class="n">ban_data</span><span class="p">,</span> <span class="n">terminal</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">corner</span><span class="p">,</span> <span class="n">n_lines</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    - check-A10: 数字マスは、線の端点である。昔のnlcheck.pyのcheck_3に相当。</span>
<span class="sd">    - check-A11: 線は枝分かれしない。昔のnlcheck.pyのcheck_4に相当。</span>
<span class="sd">    - check-A12: 線はつながっている。昔のnlcheck.pyのcheck_5に相当。</span>
<span class="sd">    - 線の長さを計算する。</span>
<span class="sd">    - 線の折れ曲がり回数を計算する。</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ban_data : numpy array</span>
<span class="sd">        board data</span>

<span class="sd">    terminal : list of dict</span>
<span class="sd">        given from detect_terminal</span>

<span class="sd">    count : numpy array</span>
<span class="sd">        given from count_neighbors</span>

<span class="sd">    corner : numpy array</span>
<span class="sd">        given from count_neighbors</span>

<span class="sd">    n_lines : int</span>
<span class="sd">        number of lines</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    line_length : numpy array</span>
<span class="sd">        length of lines</span>

<span class="sd">    line_corner : numpy array</span>
<span class="sd">        number of corners of lines</span>


<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    RuntimeError</span>
<span class="sd">        a condition is not satisfied.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">line_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_lines</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">line_corner</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_lines</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_lines</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">bit</span> <span class="o">=</span> <span class="p">(</span><span class="n">ban_data</span><span class="o">==</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># bitmap of the line</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">count</span> <span class="o">*</span> <span class="n">bit</span>   <span class="c1"># count map masked by the line</span>
        <span class="n">dat</span> <span class="o">=</span> <span class="n">bit</span> <span class="o">*</span> <span class="n">line</span>    <span class="c1"># view of the line</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="n">terminal</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;xy&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">count</span><span class="p">[</span><span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-A10: not terminal&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">xy</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">mat</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">pass</span> <span class="c1"># 枝分かれしていないのでOK</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># 3以上のマスと接続しているということは、枝分かれしている</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-A11: line is branched&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">dat</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">3</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">mat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">():</span>
            <span class="c1"># 端点(接続数が1のマス)が、3個以上あるということは、線は非連結である</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;check-A12: line is disjoint&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">dat</span><span class="p">)</span>
        <span class="n">line_length</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">bit</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">line_corner</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">bit</span> <span class="o">*</span> <span class="n">corner</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">line_length</span><span class="p">,</span> <span class="n">line_corner</span></div>

<div class="viewcode-block" id="bounding_box"><a class="viewcode-back" href="../apis/adc2019.html#adc2019.bounding_box">[docs]</a><span class="k">def</span> <span class="nf">bounding_box</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ignore all-zero rows and columns and get bounding box of array</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : numpy array</span>
<span class="sd">        array</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    x0, y0, x1, y1 : tuple of int</span>
<span class="sd">        (x0,y0) = left-top</span>
<span class="sd">        (x1,y1) = right bottom</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hi</span><span class="p">,</span> <span class="n">wi</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># nまで進んだらゼロ行列ではないので、1つ戻る(-1)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">a</span><span class="p">[(</span><span class="n">hi</span><span class="o">-</span><span class="n">s</span><span class="p">):</span><span class="n">hi</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">hi</span> <span class="o">-</span> <span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">w</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">w</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">e</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">a</span><span class="p">[:,</span> <span class="p">(</span><span class="n">wi</span><span class="o">-</span><span class="n">e</span><span class="p">):</span><span class="n">wi</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">e</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">wi</span> <span class="o">-</span> <span class="p">(</span><span class="n">e</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span></div>


<div class="viewcode-block" id="check"><a class="viewcode-back" href="../apis/adc2019.html#adc2019.check">[docs]</a><span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">Q_file</span><span class="p">,</span> <span class="n">A_file</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    Q_file : None or [str]</span>
<span class="sd">        filename of Q text file</span>

<span class="sd">    A_file : None or [str]</span>
<span class="sd">        filename of A text file</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    check_data : dict</span>
<span class="sd">       see :py:meth:`adc2019.check_data`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">debug</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">A</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">Q_file</span><span class="p">:</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">read_Q_file</span><span class="p">(</span><span class="n">Q_file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">A_file</span><span class="p">:</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">read_A_file</span><span class="p">(</span><span class="n">A_file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">Q</span> <span class="ow">and</span> <span class="n">A</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">check_data</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span></div>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../apis/adc2019.html#adc2019.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    command line interface</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">debug</span><span class="p">,</span> <span class="n">verbose</span>
    <span class="kn">import</span> <span class="nn">argparse</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;DA Symposium 2019 Algorith Degisn Contest, Command Line Interface tool&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--debug&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;enable debug mode&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--verbose&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;verbose message&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--report&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;output detailed report&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--Q-file&#39;</span><span class="p">,</span> <span class="s1">&#39;-Q&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Q filename&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--A-file&#39;</span><span class="p">,</span> <span class="s1">&#39;-A&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Q filename&#39;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="c1">#print(args); sys.exit(1)</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">debug</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">Q_file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">A_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">check</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">Q_file</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">A_file</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">report</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ADC2019 rule violation&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">quality</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">quality</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">report</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">quality</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">adc2019 20190802 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, IPSJ SLDM.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.5.
    </div>
  </body>
</html>